var L=Object.defineProperty;var m=(t,a)=>L(t,"name",{value:a,configurable:!0});import{useEffect as Y}from"react";import ee from"lodash-es/get";import te from"lodash-es/has";import{useForm as re}from"react-hook-form";import{useForm as se,useWarnAboutChange as ae,useTranslate as oe,useRefineContext as ne,flattenObjectKeys as z}from"@refinedev/core";var C=m(({refineCoreProps:t,warnWhenUnsavedChanges:a,disableServerSideValidation:p=!1,...Q}={})=>{let{options:F}=ne(),S=(F==null?void 0:F.disableServerSideValidation)||p,U=oe(),{warnWhenUnsavedChanges:h,setWarnWhen:b}=ae(),f=a??h,d=re({...Q}),{watch:c,setValue:R,getValues:i,handleSubmit:T,setError:x}=d,E=se({...t,onMutationError:(r,s,e)=>{var v,H;if(S){(v=t==null?void 0:t.onMutationError)==null||v.call(t,r,s,e);return}let y=r==null?void 0:r.errors;for(let V in y){if(!Object.keys(z(s)).includes(V))continue;let u=y[V],D="";Array.isArray(u)&&(D=u.join(" ")),typeof u=="string"&&(D=u),typeof u=="boolean"&&u&&(D="Field is not valid."),typeof u=="object"&&"key"in u&&(D=U(u.key,u.message)),x(V,{message:D})}(H=t==null?void 0:t.onMutationError)==null||H.call(t,r,s,e)}}),{queryResult:l,onFinish:o,formLoading:B,onFinishAutoSave:j}=E;Y(()=>{var e;let r=(e=l==null?void 0:l.data)==null?void 0:e.data;if(!r)return;Object.keys(z(i())).forEach(y=>{let v=te(r,y),H=ee(r,y);v&&R(y,H)})},[l==null?void 0:l.data,R,i]),Y(()=>{let r=c((s,{type:e})=>{e==="change"&&W(s)});return()=>r.unsubscribe()},[c]);let W=m(r=>{var s;if(f&&b(!0),t!=null&&t.autoSave){b(!1);let e=(s=t.autoSave)==null?void 0:s.onFinish;return j(e?e(r):r)}return r},"onValuesChange"),g=m((r,s)=>async e=>(b(!1),T(r,s)(e)),"handleSubmit");return{...d,handleSubmit:g,refineCore:E,saveButtonProps:{disabled:B,onClick:r=>{g(o,()=>!1)(r)}}}},"useForm");import{useEffect as de,useState as Te}from"react";var ie=m(({stepsProps:t,...a}={})=>{let{defaultStep:p=0,isBackValidate:Q=!1}=t??{},[F,S]=Te(p),U=C({...a}),{trigger:h,getValues:b,setValue:f,formState:{dirtyFields:d},refineCore:{queryResult:c}}=U;de(()=>{var E;let T=(E=c==null?void 0:c.data)==null?void 0:E.data;if(!T)return;let x=Object.keys(b());Object.entries(T).forEach(([l,o])=>{let B=l;x.includes(B)&&(d[B]||f(B,o))})},[c==null?void 0:c.data,F,f,b]);let R=m(T=>{let x=T;T<0&&(x=0),S(x)},"go");return{...U,steps:{currentStep:F,gotoStep:m(async T=>{if(T===F)return;if(T<F&&!Q){R(T);return}await h()&&R(T)},"gotoStep")}}},"useStepsForm");import{useCallback as J}from"react";import{useGo as le,useModal as ue,useParsed as pe,useResource as ce,useUserFriendlyName as me,useTranslate as Fe,useWarnAboutChange as Re,useInvalidate as Ee}from"@refinedev/core";import P from"react";var xe=m(({modalProps:t,refineCoreProps:a,syncWithLocation:p,...Q}={})=>{var A,N;let F=Ee(),[S,U]=P.useState(!1),h=Fe(),{resource:b,action:f}=a??{},{resource:d,action:c,identifier:R}=ce(b),i=pe(),T=le(),x=me(),E=f??c??"",l=!(typeof p=="object"&&(p==null?void 0:p.syncId)===!1),o=typeof p=="object"&&"key"in p?p.key:d&&E&&p?`modal-${R}-${E}`:void 0,{defaultVisible:B=!1,autoSubmitClose:j=!0,autoResetForm:W=!0}=t??{},g=C({refineCoreProps:{...a,meta:{...o?{[o]:void 0}:{},...a==null?void 0:a.meta}},...Q}),{reset:$,refineCore:{onFinish:r,id:s,setId:e,autoSaveProps:y},saveButtonProps:v,handleSubmit:H}=g,{visible:V,show:k,close:u}=ue({defaultVisible:B});P.useEffect(()=>{var n,w,K,I;if(S===!1&&o){let M=(w=(n=i==null?void 0:i.params)==null?void 0:n[o])==null?void 0:w.open;if(typeof M=="boolean"?M&&k():typeof M=="string"&&M==="true"&&k(),l){let G=(I=(K=i==null?void 0:i.params)==null?void 0:K[o])==null?void 0:I.id;G&&(e==null||e(G))}U(!0)}},[o,i,l,e]),P.useEffect(()=>{var n;S===!0&&(V&&o?T({query:{[o]:{...(n=i==null?void 0:i.params)==null?void 0:n[o],open:!0,...l&&s&&{id:s}}},options:{keepQuery:!0},type:"replace"}):o&&!V&&T({query:{[o]:void 0},options:{keepQuery:!0},type:"replace"}))},[s,V,k,o,l]);let D=m(async n=>{await r(n),j&&u(),W&&$()},"submit"),{warnWhen:O,setWarnWhen:X}=Re(),Z=J(()=>{var n;if(y.status==="success"&&((n=a==null?void 0:a.autoSave)!=null&&n.invalidateOnClose)&&F({id:s,invalidates:a.invalidates||["list","many","detail"],dataProviderName:a.dataProviderName,resource:R}),O)if(window.confirm(h("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))X(!1);else return;e==null||e(void 0),u()},[O,y.status]),_=J(n=>{typeof n<"u"&&(e==null||e(n)),(!(E==="edit"||E==="clone")||(typeof n<"u"||typeof s<"u"))&&k()},[s]),q=h(`${R}.titles.${f}`,void 0,`${x(`${f} ${((A=d==null?void 0:d.meta)==null?void 0:A.label)??((N=d==null?void 0:d.options)==null?void 0:N.label)??(d==null?void 0:d.label)??R}`,"singular")}`);return{modal:{submit:D,close:Z,show:_,visible:V,title:q},...g,saveButtonProps:{...v,onClick:n=>H(D)(n)}}},"useModalForm");export{C as useForm,xe as useModalForm,ie as useStepsForm};
//# sourceMappingURL=index.js.map