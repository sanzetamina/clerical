var ie=Object.create;var M=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var R=(e,t)=>M(e,"name",{value:t,configurable:!0});var me=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})},L=(e,t,s,V)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ue(t))!ce.call(e,n)&&n!==s&&M(e,n,{get:()=>t[n],enumerable:!(V=le(t,n))||V.enumerable});return e};var G=(e,t,s)=>(s=e!=null?ie(pe(e)):{},L(t||!e||!e.__esModule?M(s,"default",{value:e,enumerable:!0}):s,e)),Fe=e=>L(M({},"__esModule",{value:!0}),e);var Re={};me(Re,{useForm:()=>C,useModalForm:()=>ae,useStepsForm:()=>se});module.exports=Fe(Re);var Y=require("react"),ee=G(require("lodash/get")),te=G(require("lodash/has")),re=require("react-hook-form"),E=require("@refinedev/core");var C=R(({refineCoreProps:e,warnWhenUnsavedChanges:t,disableServerSideValidation:s=!1,...V}={})=>{let{options:n}=(0,E.useRefineContext)(),v=(n==null?void 0:n.disableServerSideValidation)||s,H=(0,E.useTranslate)(),{warnWhenUnsavedChanges:Q,setWarnWhen:D}=(0,E.useWarnAboutChange)(),B=t??Q,l=(0,re.useForm)({...V}),{watch:F,setValue:x,getValues:p,handleSubmit:u,setError:b}=l,y=(0,E.useForm)({...e,onMutationError:(a,o,r)=>{var g,k;if(v){(g=e==null?void 0:e.onMutationError)==null||g.call(e,a,o,r);return}let f=a==null?void 0:a.errors;for(let S in f){if(!Object.keys((0,E.flattenObjectKeys)(o)).includes(S))continue;let m=f[S],U="";Array.isArray(m)&&(U=m.join(" ")),typeof m=="string"&&(U=m),typeof m=="boolean"&&m&&(U="Field is not valid."),typeof m=="object"&&"key"in m&&(U=H(m.key,m.message)),b(S,{message:U})}(k=e==null?void 0:e.onMutationError)==null||k.call(e,a,o,r)}}),{queryResult:c,onFinish:d,formLoading:h,onFinishAutoSave:W}=y;(0,Y.useEffect)(()=>{var r;let a=(r=c==null?void 0:c.data)==null?void 0:r.data;if(!a)return;Object.keys((0,E.flattenObjectKeys)(p())).forEach(f=>{let g=(0,te.default)(a,f),k=(0,ee.default)(a,f);g&&x(f,k)})},[c==null?void 0:c.data,x,p]),(0,Y.useEffect)(()=>{let a=F((o,{type:r})=>{r==="change"&&A(o)});return()=>a.unsubscribe()},[F]);let A=R(a=>{var o;if(B&&D(!0),e!=null&&e.autoSave){D(!1);let r=(o=e.autoSave)==null?void 0:o.onFinish;return W(r?r(a):a)}return a},"onValuesChange"),j=R((a,o)=>async r=>(D(!1),u(a,o)(r)),"handleSubmit");return{...l,handleSubmit:j,refineCore:y,saveButtonProps:{disabled:h,onClick:a=>{j(d,()=>!1)(a)}}}},"useForm");var P=require("react");var se=R(({stepsProps:e,...t}={})=>{let{defaultStep:s=0,isBackValidate:V=!1}=e??{},[n,v]=(0,P.useState)(s),H=C({...t}),{trigger:Q,getValues:D,setValue:B,formState:{dirtyFields:l},refineCore:{queryResult:F}}=H;(0,P.useEffect)(()=>{var y;let u=(y=F==null?void 0:F.data)==null?void 0:y.data;if(!u)return;let b=Object.keys(D());Object.entries(u).forEach(([c,d])=>{let h=c;b.includes(h)&&(l[h]||B(h,d))})},[F==null?void 0:F.data,n,B,D]);let x=R(u=>{let b=u;u<0&&(b=0),v(b)},"go");return{...H,steps:{currentStep:n,gotoStep:R(async u=>{if(u===n)return;if(u<n&&!V){x(u);return}await Q()&&x(u)},"gotoStep")}}},"useStepsForm");var z=require("react"),i=require("@refinedev/core");var $=G(require("react"));var ae=R(({modalProps:e,refineCoreProps:t,syncWithLocation:s,...V}={})=>{var X,Z;let n=(0,i.useInvalidate)(),[v,H]=$.default.useState(!1),Q=(0,i.useTranslate)(),{resource:D,action:B}=t??{},{resource:l,action:F,identifier:x}=(0,i.useResource)(D),p=(0,i.useParsed)(),u=(0,i.useGo)(),b=(0,i.useUserFriendlyName)(),y=B??F??"",c=!(typeof s=="object"&&(s==null?void 0:s.syncId)===!1),d=typeof s=="object"&&"key"in s?s.key:l&&y&&s?`modal-${x}-${y}`:void 0,{defaultVisible:h=!1,autoSubmitClose:W=!0,autoResetForm:A=!0}=e??{},j=C({refineCoreProps:{...t,meta:{...d?{[d]:void 0}:{},...t==null?void 0:t.meta}},...V}),{reset:J,refineCore:{onFinish:a,id:o,setId:r,autoSaveProps:f},saveButtonProps:g,handleSubmit:k}=j,{visible:S,show:w,close:m}=(0,i.useModal)({defaultVisible:h});$.default.useEffect(()=>{var T,O,I,_;if(v===!1&&d){let K=(O=(T=p==null?void 0:p.params)==null?void 0:T[d])==null?void 0:O.open;if(typeof K=="boolean"?K&&w():typeof K=="string"&&K==="true"&&w(),c){let q=(_=(I=p==null?void 0:p.params)==null?void 0:I[d])==null?void 0:_.id;q&&(r==null||r(q))}H(!0)}},[d,p,c,r]),$.default.useEffect(()=>{var T;v===!0&&(S&&d?u({query:{[d]:{...(T=p==null?void 0:p.params)==null?void 0:T[d],open:!0,...c&&o&&{id:o}}},options:{keepQuery:!0},type:"replace"}):d&&!S&&u({query:{[d]:void 0},options:{keepQuery:!0},type:"replace"}))},[o,S,w,d,c]);let U=R(async T=>{await a(T),W&&m(),A&&J()},"submit"),{warnWhen:N,setWarnWhen:oe}=(0,i.useWarnAboutChange)(),ne=(0,z.useCallback)(()=>{var T;if(f.status==="success"&&((T=t==null?void 0:t.autoSave)!=null&&T.invalidateOnClose)&&n({id:o,invalidates:t.invalidates||["list","many","detail"],dataProviderName:t.dataProviderName,resource:x}),N)if(window.confirm(Q("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))oe(!1);else return;r==null||r(void 0),m()},[N,f.status]),de=(0,z.useCallback)(T=>{typeof T<"u"&&(r==null||r(T)),(!(y==="edit"||y==="clone")||(typeof T<"u"||typeof o<"u"))&&w()},[o]),Te=Q(`${x}.titles.${B}`,void 0,`${b(`${B} ${((X=l==null?void 0:l.meta)==null?void 0:X.label)??((Z=l==null?void 0:l.options)==null?void 0:Z.label)??(l==null?void 0:l.label)??x}`,"singular")}`);return{modal:{submit:U,close:ne,show:de,visible:S,title:Te},...j,saveButtonProps:{...g,onClick:T=>k(U)(T)}}},"useModalForm");
//# sourceMappingURL=index.js.map